{% extends "views/model/layout.html.jinja" %}
{% import "macros/icons.html.jinja" as icons %}
{% import "macros/clipboard.html.jinja" as clipboard %}

{% block content %}
  <div class="flex h-full justify-end">
    {% if view.query_fields %}
      <form action method="GET">
        <label class="input">
          {{ icons.magnifying_glass("h-[1em] opacity-50") }}
          <input
            class="grow"
            type="search"
            placeholder="Filter by {{ view.query_fields | map('keygetter', view.fields) | join(', ') }}"
            name="query"
            value="{{ query or '' }}"
          />
        </label>
      </form>
    {% endif %}
  </div>
  <div class="border-base-200 overflow-x-auto border">
    <table class="table">
      <thead>
        <tr>
          {% for field in view.fields %}
            <th>
              {% if field in view.sortable_fields %}
                <a
                  class="link link-hover flex flex-row items-center gap-1"
                  href="{{ sorting.get_sorting_route(field) }}"
                >
                  {{ view.fields[field] }}
                  {% if sorting.fields[field] %}
                    {% if sorting.fields[field] == "ASC" %}
                      {{ icons.arrow_long_down("h-4 w-4") }}
                    {% else %}
                      {{ icons.arrow_long_up("h-4 w-4") }}
                    {% endif %}
                  {% else %}
                    <span class="h-4 w-4"></span>
                  {% endif %}
                </a>
              {% else %}
                {{ view.fields[field] }}
              {% endif %}
            </th>
          {% endfor %}
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr class="hover">
            {% for field in view.fields %}
              <td class="group">
                <div class="flex flex-row items-center gap-2">
                  {% if loop.first %}
                    <a
                      class="link link-hover link-primary"
                      href="{{ request.url_for(view.viewset.get_view('edit').route_name, pk=view.viewset.pk_getter(item)) }}"
                      >{{ item[field] }}</a
                    >
                  {% else %}
                    {{ item[field] }}
                  {% endif %}
                  {{ clipboard.copy(item[field], class="invisible group-hover:visible") }}
                </div>
              </td>
            {% endfor %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  <div class="flex justify-between">
    <div class="text-sm">
      Showing
      <span class="font-bold">{{ pagination.range[0] }}</span>
      to
      <span class="font-bold">{{ pagination.range[1] }}</span>
      of
      <span class="font-bold">{{ pagination.total }}</span>
      entries
    </div>
    <div class="join grid grid-cols-2">
      <a
        class="join-item btn btn-primary"
        href="{{ pagination.previous_route or '' }}"
        {{ 'disabled' if not pagination.previous_route else '' }}
        >Previous</a
      >
      <a
        class="join-item btn btn-primary"
        href="{{ pagination.next_route or '' }}"
        {{ 'disabled' if not pagination.next_route else '' }}
        >Next</a
      >
    </div>
  </div>
{% endblock %}
